> feedeliza-plus@1.0.0 start
> node backend/server.js
Redis Client Connected
‚úÖ Conex√£o com banco de dados estabelecida
üöÄ Servidor rodando na porta 5000
DEBUG: authMiddleware - error: NotFoundError: Usu√°rio n√£o encontrado
    at Object.getMe (/app/backend/src/domains/auth/auth.service.js:117:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async authMiddleware (/app/backend/src/middleware/authMiddleware.js:24:18) {
  statusCode: 404
}
Error caught by middleware: NotFoundError: Usu√°rio n√£o encontrado
    at Object.getMe (/app/backend/src/domains/auth/auth.service.js:117:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async authMiddleware (/app/backend/src/middleware/authMiddleware.js:24:18) {
  statusCode: 404
}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at /app/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/app/node_modules/express/lib/router/index.js:346:12)
    at next (/app/node_modules/express/lib/router/index.js:280:10)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at /app/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/app/node_modules/express/lib/router/index.js:346:12)
    at next (/app/node_modules/express/lib/router/index.js:280:10)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}
DEBUG: Before bump - Restaurant b3adad74-2fd6-47eb-a356-e5fe3c83c446 perm_version: undefined
DEBUG: After bump - Restaurant b3adad74-2fd6-47eb-a356-e5fe3c83c446 perm_version: 1
DEBUG: authMiddleware - error: NotFoundError: Usu√°rio n√£o encontrado
    at Object.getMe (/app/backend/src/domains/auth/auth.service.js:117:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async authMiddleware (/app/backend/src/middleware/authMiddleware.js:24:18) {
  statusCode: 404
}
Error caught by middleware: NotFoundError: Usu√°rio n√£o encontrado
    at Object.getMe (/app/backend/src/domains/auth/auth.service.js:117:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async authMiddleware (/app/backend/src/middleware/authMiddleware.js:24:18) {
  statusCode: 404
}
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
DEBUG: Before bump - Restaurant 8cc4b53c-28a8-4a23-86c4-a2dea347ecbe perm_version: undefined
DEBUG: After bump - Restaurant 8cc4b53c-28a8-4a23-86c4-a2dea347ecbe perm_version: 1
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Checkin.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Object.getCheckinAnalytics (/app/backend/src/domains/checkin/checkin.service.js:400:33)
    at async exports.getCheckinAnalytics (/app/backend/src/domains/checkin/checkin.controller.js:88:23) {
  name: 'SequelizeDatabaseError',
  parent: error: column "checkincount" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 113,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '514',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
    parameters: undefined
  },
  original: error: column "checkincount" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 113,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '514',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
    parameters: undefined
  },
  sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
  parameters: {}
}
Error caught by middleware: Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Checkin.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Object.getCheckinAnalytics (/app/backend/src/domains/checkin/checkin.service.js:400:33)
    at async exports.getCheckinAnalytics (/app/backend/src/domains/checkin/checkin.controller.js:88:23) {
  name: 'SequelizeDatabaseError',
  parent: error: column "checkincount" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 113,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '514',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
    parameters: undefined
  },
  original: error: column "checkincount" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 113,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '514',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
    parameters: undefined
  },
  sql: `SELECT "Checkin"."customer_id" AS "customerId", COUNT("Checkin"."id") AS "checkinCount", "customer"."id" AS "customer.id", "customer"."name" AS "customer.name", "customer"."email" AS "customer.email" FROM "checkins" AS "Checkin" LEFT OUTER JOIN "customers" AS "customer" ON "Checkin"."customer_id" = "customer"."id" WHERE "Checkin"."status" = 'completed' AND "Checkin"."restaurant_id" = 'b3adad74-2fd6-47eb-a356-e5fe3c83c446' GROUP BY "customerId", "customer"."id", "customer"."name", "customer"."email" ORDER BY checkinCount DESC LIMIT 10;`,
  parameters: {}
}
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error counting checkins: TypeError: Cannot read properties of undefined (reading 'Checkin')
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:26:38)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: Error: Failed to get checkin count
    at Object.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.service.js:31:15)
    at exports.getDashboardOverview (/app/backend/src/domains/dashboard/dashboard.controller.js:17:41)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at middleware (/app/node_modules/express-validator/lib/middlewares/check.js:16:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: TypeError: Cannot read properties of undefined (reading 'Survey')
    at exports.listSurveys (/app/backend/src/domains/survey/survey.service.js:18:34)
    at exports.listSurveys (/app/backend/src/domains/survey/survey.controller.js:17:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Error caught by middleware: TypeError: Cannot read properties of undefined (reading 'Survey')
    at exports.listSurveys (/app/backend/src/domains/survey/survey.service.js:18:34)
    at exports.listSurveys (/app/backend/src/domains/survey/survey.controller.js:17:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)