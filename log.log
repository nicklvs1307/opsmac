root@ServerAgents:~/opsmac# docker exec -it 51e12df6a7dd node backend/scripts/syncDb.js
Iniciando sincronização do banco de dados...
❌ Erro ao sincronizar banco: Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.createTable (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:98:12)
    at async Customer.sync (/app/node_modules/sequelize/lib/model.js:942:7)
    at async Sequelize.sync (/app/node_modules/sequelize/lib/sequelize.js:377:9)
    at async db.syncDatabase (/app/backend/models/index.js:69:5)
    at async runSync (/app/backend/scripts/syncDb.js:8:19) {
  name: 'SequelizeDatabaseError',
  parent: error: relation "Surveys" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 105,
    severity: 'ERROR',
    code: '42P01',
    detail: undefined,
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'namespace.c',
    line: '433',
    routine: 'RangeVarGetRelidExtended',
    sql: `CREATE TABLE IF NOT EXISTS "customers" ("id" UUID , "name" VARCHAR(100), "email" VARCHAR(150), "phone" VARCHAR(20), "cpf" VARCHAR(11) UNIQUE, "whatsapp" VARCHAR(20), "birth_date" DATE, "gender" "public"."enum_customers_gender", "avatar" VARCHAR(500), "preferences" JSONB DEFAULT '{"cuisine_types":[],"dietary_restrictions":[],"communication_preferences":{"email":true,"whatsapp":false,"sms":false},"favorite_dishes":[],"allergies":[]}', "loyalty_points" INTEGER DEFAULT 0, "total_visits" INTEGER DEFAULT 0, "total_spent" DECIMAL(10,2) DEFAULT 0, "average_rating_given" DECIMAL(3,2) DEFAULT 0, "last_visit" TIMESTAMP WITH TIME ZONE, "first_visit" TIMESTAMP WITH TIME ZONE, "customer_segment" "public"."enum_customers_customer_segment" DEFAULT 'new', "status" "public"."enum_customers_status" DEFAULT 'active', "source" "public"."enum_customers_source", "referral_code" VARCHAR(20) UNIQUE, "referred_by" UUID REFERENCES "customers" ("id"), "notes" TEXT, "tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[], "marketing_consent" BOOLEAN DEFAULT false, "email_verified" BOOLEAN DEFAULT false, "phone_verified" BOOLEAN DEFAULT false, "gdpr_consent" BOOLEAN DEFAULT false, "gdpr_consent_date" TIMESTAMP WITH TIME ZONE, "last_birthday_message_year" INTEGER , "metadata" JSONB DEFAULT '{"acquisition_source":null,"utm_campaign":null,"utm_source":null,"utm_medium":null,"device_info":null,"location_data":null}', "rfv_score" JSONB DEFAULT '{"recency":null,"frequency":null,"monetary":null}' , "nps_segment" "public"."enum_customers_nps_segment" DEFAULT 'unknown' , "last_purchase_date" TIMESTAMP WITH TIME ZONE , "total_orders" INTEGER DEFAULT 0 , "average_ticket" DECIMAL(10,2) DEFAULT 0 , "last_ticket_value" DECIMAL(10,2) DEFAULT 0 , "most_bought_products" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "most_bought_categories" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "purchase_behavior_tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "location_details" JSONB DEFAULT '{"neighborhood":null,"city":null,"zone":null,"distance_from_store":null}' , "preferred_communication_channel" "public"."enum_customers_preferred_communication_channel" DEFAULT 'none' , "campaign_interaction_history" JSONB DEFAULT '{}' , "last_survey_completed_at" TIMESTAMP WITH TIME ZONE , "last_survey_id" UUID REFERENCES "Surveys" ("id") ON DELETE SET NULL ON UPDATE CASCADE , "created_at" TIMESTAMP WITH TIME ZONE NOT NULL, "updated_at" TIMESTAMP WITH TIME ZONE NOT NULL, "restaurant_id" UUID REFERENCES "restaurants" ("id") ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("id")); COMMENT ON COLUMN "customers"."last_birthday_message_year" IS 'Ano em que a última mensagem de aniversário foi enviada'; COMMENT ON COLUMN "customers"."rfv_score" IS 'Pontuação RFV (Recência, Frequência, Valor)'; COMMENT ON COLUMN "customers"."nps_segment" IS 'Segmento NPS do cliente'; COMMENT ON COLUMN "customers"."last_purchase_date" IS 'Data da última compra/check-in'; COMMENT ON COLUMN "customers"."total_orders" IS 'Número total de pedidos/check-ins'; COMMENT ON COLUMN "customers"."average_ticket" IS 'Ticket médio do cliente'; COMMENT ON COLUMN "customers"."last_ticket_value" IS 'Valor do último pedido/check-in'; COMMENT ON COLUMN "customers"."most_bought_products" IS 'Lista de produtos mais comprados (placeholder)'; COMMENT ON COLUMN "customers"."most_bought_categories" IS 'Lista de categorias mais compradas (placeholder)'; COMMENT ON COLUMN "customers"."purchase_behavior_tags" IS 'Tags de comportamento de compra (ex: weekend_shopper)'; COMMENT ON COLUMN "customers"."location_details" IS 'Detalhes de localização do cliente'; COMMENT ON COLUMN "customers"."preferred_communication_channel" IS 'Canal de comunicação preferido do cliente'; COMMENT ON COLUMN "customers"."campaign_interaction_history" IS 'Histórico de interação com campanhas'; COMMENT ON COLUMN "customers"."last_survey_completed_at" IS 'Data da última pesquisa respondida'; COMMENT ON COLUMN "customers"."last_survey_id" IS 'ID da última pesquisa respondida';`,
    parameters: undefined
  },
  original: error: relation "Surveys" does not exist
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 105,
    severity: 'ERROR',
    code: '42P01',
    detail: undefined,
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'namespace.c',
    line: '433',
    routine: 'RangeVarGetRelidExtended',
    sql: `CREATE TABLE IF NOT EXISTS "customers" ("id" UUID , "name" VARCHAR(100), "email" VARCHAR(150), "phone" VARCHAR(20), "cpf" VARCHAR(11) UNIQUE, "whatsapp" VARCHAR(20), "birth_date" DATE, "gender" "public"."enum_customers_gender", "avatar" VARCHAR(500), "preferences" JSONB DEFAULT '{"cuisine_types":[],"dietary_restrictions":[],"communication_preferences":{"email":true,"whatsapp":false,"sms":false},"favorite_dishes":[],"allergies":[]}', "loyalty_points" INTEGER DEFAULT 0, "total_visits" INTEGER DEFAULT 0, "total_spent" DECIMAL(10,2) DEFAULT 0, "average_rating_given" DECIMAL(3,2) DEFAULT 0, "last_visit" TIMESTAMP WITH TIME ZONE, "first_visit" TIMESTAMP WITH TIME ZONE, "customer_segment" "public"."enum_customers_customer_segment" DEFAULT 'new', "status" "public"."enum_customers_status" DEFAULT 'active', "source" "public"."enum_customers_source", "referral_code" VARCHAR(20) UNIQUE, "referred_by" UUID REFERENCES "customers" ("id"), "notes" TEXT, "tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[], "marketing_consent" BOOLEAN DEFAULT false, "email_verified" BOOLEAN DEFAULT false, "phone_verified" BOOLEAN DEFAULT false, "gdpr_consent" BOOLEAN DEFAULT false, "gdpr_consent_date" TIMESTAMP WITH TIME ZONE, "last_birthday_message_year" INTEGER , "metadata" JSONB DEFAULT '{"acquisition_source":null,"utm_campaign":null,"utm_source":null,"utm_medium":null,"device_info":null,"location_data":null}', "rfv_score" JSONB DEFAULT '{"recency":null,"frequency":null,"monetary":null}' , "nps_segment" "public"."enum_customers_nps_segment" DEFAULT 'unknown' , "last_purchase_date" TIMESTAMP WITH TIME ZONE , "total_orders" INTEGER DEFAULT 0 , "average_ticket" DECIMAL(10,2) DEFAULT 0 , "last_ticket_value" DECIMAL(10,2) DEFAULT 0 , "most_bought_products" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "most_bought_categories" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "purchase_behavior_tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "location_details" JSONB DEFAULT '{"neighborhood":null,"city":null,"zone":null,"distance_from_store":null}' , "preferred_communication_channel" "public"."enum_customers_preferred_communication_channel" DEFAULT 'none' , "campaign_interaction_history" JSONB DEFAULT '{}' , "last_survey_completed_at" TIMESTAMP WITH TIME ZONE , "last_survey_id" UUID REFERENCES "Surveys" ("id") ON DELETE SET NULL ON UPDATE CASCADE , "created_at" TIMESTAMP WITH TIME ZONE NOT NULL, "updated_at" TIMESTAMP WITH TIME ZONE NOT NULL, "restaurant_id" UUID REFERENCES "restaurants" ("id") ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("id")); COMMENT ON COLUMN "customers"."last_birthday_message_year" IS 'Ano em que a última mensagem de aniversário foi enviada'; COMMENT ON COLUMN "customers"."rfv_score" IS 'Pontuação RFV (Recência, Frequência, Valor)'; COMMENT ON COLUMN "customers"."nps_segment" IS 'Segmento NPS do cliente'; COMMENT ON COLUMN "customers"."last_purchase_date" IS 'Data da última compra/check-in'; COMMENT ON COLUMN "customers"."total_orders" IS 'Número total de pedidos/check-ins'; COMMENT ON COLUMN "customers"."average_ticket" IS 'Ticket médio do cliente'; COMMENT ON COLUMN "customers"."last_ticket_value" IS 'Valor do último pedido/check-in'; COMMENT ON COLUMN "customers"."most_bought_products" IS 'Lista de produtos mais comprados (placeholder)'; COMMENT ON COLUMN "customers"."most_bought_categories" IS 'Lista de categorias mais compradas (placeholder)'; COMMENT ON COLUMN "customers"."purchase_behavior_tags" IS 'Tags de comportamento de compra (ex: weekend_shopper)'; COMMENT ON COLUMN "customers"."location_details" IS 'Detalhes de localização do cliente'; COMMENT ON COLUMN "customers"."preferred_communication_channel" IS 'Canal de comunicação preferido do cliente'; COMMENT ON COLUMN "customers"."campaign_interaction_history" IS 'Histórico de interação com campanhas'; COMMENT ON COLUMN "customers"."last_survey_completed_at" IS 'Data da última pesquisa respondida'; COMMENT ON COLUMN "customers"."last_survey_id" IS 'ID da última pesquisa respondida';`,
    parameters: undefined
  },
  sql: `CREATE TABLE IF NOT EXISTS "customers" ("id" UUID , "name" VARCHAR(100), "email" VARCHAR(150), "phone" VARCHAR(20), "cpf" VARCHAR(11) UNIQUE, "whatsapp" VARCHAR(20), "birth_date" DATE, "gender" "public"."enum_customers_gender", "avatar" VARCHAR(500), "preferences" JSONB DEFAULT '{"cuisine_types":[],"dietary_restrictions":[],"communication_preferences":{"email":true,"whatsapp":false,"sms":false},"favorite_dishes":[],"allergies":[]}', "loyalty_points" INTEGER DEFAULT 0, "total_visits" INTEGER DEFAULT 0, "total_spent" DECIMAL(10,2) DEFAULT 0, "average_rating_given" DECIMAL(3,2) DEFAULT 0, "last_visit" TIMESTAMP WITH TIME ZONE, "first_visit" TIMESTAMP WITH TIME ZONE, "customer_segment" "public"."enum_customers_customer_segment" DEFAULT 'new', "status" "public"."enum_customers_status" DEFAULT 'active', "source" "public"."enum_customers_source", "referral_code" VARCHAR(20) UNIQUE, "referred_by" UUID REFERENCES "customers" ("id"), "notes" TEXT, "tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[], "marketing_consent" BOOLEAN DEFAULT false, "email_verified" BOOLEAN DEFAULT false, "phone_verified" BOOLEAN DEFAULT false, "gdpr_consent" BOOLEAN DEFAULT false, "gdpr_consent_date" TIMESTAMP WITH TIME ZONE, "last_birthday_message_year" INTEGER , "metadata" JSONB DEFAULT '{"acquisition_source":null,"utm_campaign":null,"utm_source":null,"utm_medium":null,"device_info":null,"location_data":null}', "rfv_score" JSONB DEFAULT '{"recency":null,"frequency":null,"monetary":null}' , "nps_segment" "public"."enum_customers_nps_segment" DEFAULT 'unknown' , "last_purchase_date" TIMESTAMP WITH TIME ZONE , "total_orders" INTEGER DEFAULT 0 , "average_ticket" DECIMAL(10,2) DEFAULT 0 , "last_ticket_value" DECIMAL(10,2) DEFAULT 0 , "most_bought_products" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "most_bought_categories" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "purchase_behavior_tags" VARCHAR(255)[] DEFAULT ARRAY[]::VARCHAR(255)[] , "location_details" JSONB DEFAULT '{"neighborhood":null,"city":null,"zone":null,"distance_from_store":null}' , "preferred_communication_channel" "public"."enum_customers_preferred_communication_channel" DEFAULT 'none' , "campaign_interaction_history" JSONB DEFAULT '{}' , "last_survey_completed_at" TIMESTAMP WITH TIME ZONE , "last_survey_id" UUID REFERENCES "Surveys" ("id") ON DELETE SET NULL ON UPDATE CASCADE , "created_at" TIMESTAMP WITH TIME ZONE NOT NULL, "updated_at" TIMESTAMP WITH TIME ZONE NOT NULL, "restaurant_id" UUID REFERENCES "restaurants" ("id") ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("id")); COMMENT ON COLUMN "customers"."last_birthday_message_year" IS 'Ano em que a última mensagem de aniversário foi enviada'; COMMENT ON COLUMN "customers"."rfv_score" IS 'Pontuação RFV (Recência, Frequência, Valor)'; COMMENT ON COLUMN "customers"."nps_segment" IS 'Segmento NPS do cliente'; COMMENT ON COLUMN "customers"."last_purchase_date" IS 'Data da última compra/check-in'; COMMENT ON COLUMN "customers"."total_orders" IS 'Número total de pedidos/check-ins'; COMMENT ON COLUMN "customers"."average_ticket" IS 'Ticket médio do cliente'; COMMENT ON COLUMN "customers"."last_ticket_value" IS 'Valor do último pedido/check-in'; COMMENT ON COLUMN "customers"."most_bought_products" IS 'Lista de produtos mais comprados (placeholder)'; COMMENT ON COLUMN "customers"."most_bought_categories" IS 'Lista de categorias mais compradas (placeholder)'; COMMENT ON COLUMN "customers"."purchase_behavior_tags" IS 'Tags de comportamento de compra (ex: weekend_shopper)'; COMMENT ON COLUMN "customers"."location_details" IS 'Detalhes de localização do cliente'; COMMENT ON COLUMN "customers"."preferred_communication_channel" IS 'Canal de comunicação preferido do cliente'; COMMENT ON COLUMN "customers"."campaign_interaction_history" IS 'Histórico de interação com campanhas'; COMMENT ON COLUMN "customers"."last_survey_completed_at" IS 'Data da última pesquisa respondida'; COMMENT ON COLUMN "customers"."last_survey_id" IS 'ID da última pesquisa respondida';`,
  parameters: {}
}
Falha na sincronização do banco de dados.