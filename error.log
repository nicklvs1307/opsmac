> feedeliza-plus@1.0.0 start
> node server.js
2025-09-16 22:51:21 [info]: 	Redis Client Connected
2025-09-16 22:51:22 [info]: 	âœ… ConexÃ£o com banco de dados estabelecida
2025-09-16 22:51:22 [info]: 	Redis Subscriber Client Connected
2025-09-16 22:51:22 [info]: 	Subscribed to perm_invalidation channel.
2025-09-16 22:51:25 [info]: 	ðŸš€ Servidor rodando na porta 5000
2025-09-16 22:51:43 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:43 +0000] "OPTIONS /api/auth/login HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:44 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:44 +0000] "POST /api/auth/login HTTP/1.1" 200 1958 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:44 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:44 +0000] "OPTIONS /api/auth/me HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:44 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:44 +0000] "OPTIONS /api/auth/me HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:44 [info]: 	Decoded userId:
2025-09-16 22:51:44 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:44 +0000] "GET /api/auth/me HTTP/1.1" 200 1724 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:44 [info]: 	Decoded userId:
2025-09-16 22:51:44 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:44 +0000] "GET /api/auth/me HTTP/1.1" 304 - "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:45 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:45 +0000] "OPTIONS /api/iam/tree?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:45 [info]: 	Decoded userId:
2025-09-16 22:51:45 [info]: 	[IamService] Building permission snapshot for userId: d7f39993-f749-4c9a-ad16-81eb174c2b2c, restaurantId: f88e9146-f139-4dac-9241-8367cc65f917
2025-09-16 22:51:45 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:45 +0000] "OPTIONS /api/iam/check HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:45 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:45 +0000] "GET /api/iam/tree?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 200 91225 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:45 [info]: 	Decoded userId:
2025-09-16 22:51:45 [info]: 	[IamService] Checking permission for userId: d7f39993-f749-4c9a-ad16-81eb174c2b2c, restaurantId: f88e9146-f139-4dac-9241-8367cc65f917, featureKey: fidelity:general:dashboard, actionKey: read, isSuperadmin: true
2025-09-16 22:51:45 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:45 +0000] "POST /api/iam/check HTTP/1.1" 200 60 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:46 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:46 +0000] "OPTIONS /api/dashboard/f88e9146-f139-4dac-9241-8367cc65f917/analytics?period=30d HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:46 [info]: 	Decoded userId:
2025-09-16 22:51:46 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:46 +0000] "GET /api/dashboard/f88e9146-f139-4dac-9241-8367cc65f917/analytics?period=30d HTTP/1.1" 200 111 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:52 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:52 +0000] "OPTIONS /api/iam/check HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:52 [info]: 	Decoded userId:
2025-09-16 22:51:52 [info]: 	[IamService] Checking permission for userId: d7f39993-f749-4c9a-ad16-81eb174c2b2c, restaurantId: f88e9146-f139-4dac-9241-8367cc65f917, featureKey: fidelity:general:monthly-summary, actionKey: read, isSuperadmin: true
2025-09-16 22:51:52 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:52 +0000] "POST /api/iam/check HTTP/1.1" 200 60 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "OPTIONS /api/dashboard/f88e9146-f139-4dac-9241-8367cc65f917/analytics HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "OPTIONS /api/dashboard/evolution-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917&start_date=2024-09-16&end_date=2025-09-16&granularity=month HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "OPTIONS /api/dashboard/rewards-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	Decoded userId:
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "GET /api/dashboard/f88e9146-f139-4dac-9241-8367cc65f917/analytics HTTP/1.1" 200 111 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	Decoded userId:
2025-09-16 22:51:53 [info]: 	Decoded userId:
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "GET /api/dashboard/rewards-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:53 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:53 +0000] "GET /api/dashboard/evolution-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917&start_date=2024-09-16&end_date=2025-09-16&granularity=month HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Reward.aggregate (/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Reward.count (/app/node_modules/sequelize/lib/model.js:1306:20)
    at async Object.getRewardsAnalytics (file:///app/src/domains/rewards/rewards.service.js:245:27)
    at async Object.getRewardsAnalytics (file:///app/src/domains/dashboard/dashboard.service.js:131:12)
    at async DashboardController.getRewardsAnalytics (file:///app/src/domains/dashboard/dashboard.controller.js:48:9)
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Checkin.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Promise.all (index 0)
    at async Object.getEvolutionAnalytics (file:///app/src/domains/dashboard/dashboard.service.js:311:9)
    at async DashboardController.getEvolutionAnalytics (file:///app/src/domains/dashboard/dashboard.controller.js:59:20)
2025-09-16 22:51:54 [info]: 	Decoded userId:
2025-09-16 22:51:54 [info]: 	Decoded userId:
2025-09-16 22:51:54 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:54 +0000] "GET /api/dashboard/rewards-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Reward.aggregate (/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Reward.count (/app/node_modules/sequelize/lib/model.js:1306:20)
    at async Object.getRewardsAnalytics (file:///app/src/domains/rewards/rewards.service.js:245:27)
    at async Object.getRewardsAnalytics (file:///app/src/domains/dashboard/dashboard.service.js:131:12)
    at async DashboardController.getRewardsAnalytics (file:///app/src/domains/dashboard/dashboard.controller.js:48:9)
2025-09-16 22:51:54 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:54 +0000] "GET /api/dashboard/evolution-analytics?restaurantId=f88e9146-f139-4dac-9241-8367cc65f917&start_date=2024-09-16&end_date=2025-09-16&granularity=month HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Customer.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Promise.all (index 1)
    at async Object.getEvolutionAnalytics (file:///app/src/domains/dashboard/dashboard.service.js:311:9)
    at async DashboardController.getEvolutionAnalytics (file:///app/src/domains/dashboard/dashboard.controller.js:59:20)
2025-09-16 22:51:58 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:58 +0000] "OPTIONS /api/iam/check HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:58 [info]: 	Decoded userId:
2025-09-16 22:51:58 [info]: 	[IamService] Checking permission for userId: d7f39993-f749-4c9a-ad16-81eb174c2b2c, restaurantId: f88e9146-f139-4dac-9241-8367cc65f917, featureKey: fidelity:checkin:settings, actionKey: read, isSuperadmin: true
2025-09-16 22:51:58 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:58 +0000] "POST /api/iam/check HTTP/1.1" 200 60 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:59 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:59 +0000] "OPTIONS /api/rewards/restaurant/f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:59 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:59 +0000] "OPTIONS /api/settings/f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:51:59 [info]: 	Decoded userId:
2025-09-16 22:51:59 [info]: 	Decoded userId:
2025-09-16 22:51:59 [info]: 	Decoded userId:
2025-09-16 22:51:59 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:59 +0000] "GET /api/rewards/restaurant/f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Reward.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Promise.all (index 1)
    at async Reward.findAndCountAll (/app/node_modules/sequelize/lib/model.js:1322:27)
    at async Object.listRewards (file:///app/src/domains/rewards/rewards.service.js:11:29)
    at async listRewards (file:///app/src/domains/rewards/rewards.controller.js:20:22)
2025-09-16 22:51:59 [info]: 	170.254.46.100 - - [16/Sep/2025:22:51:59 +0000] "GET /api/settings/f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 200 2 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:52:00 [info]: 	Decoded userId:
2025-09-16 22:52:00 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:00 +0000] "GET /api/rewards/restaurant/f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Reward.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async Promise.all (index 1)
    at async Reward.findAndCountAll (/app/node_modules/sequelize/lib/model.js:1322:27)
    at async Object.listRewards (file:///app/src/domains/rewards/rewards.service.js:11:29)
    at async listRewards (file:///app/src/domains/rewards/rewards.controller.js:20:22)
2025-09-16 22:52:05 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:05 +0000] "OPTIONS /api/iam/check HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:52:06 [info]: 	Decoded userId:
2025-09-16 22:52:06 [info]: 	[IamService] Checking permission for userId: d7f39993-f749-4c9a-ad16-81eb174c2b2c, restaurantId: f88e9146-f139-4dac-9241-8367cc65f917, featureKey: fidelity:satisfaction:surveys, actionKey: read, isSuperadmin: true
2025-09-16 22:52:06 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:06 +0000] "POST /api/iam/check HTTP/1.1" 200 60 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:52:06 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:06 +0000] "OPTIONS /api/surveys?search=&restaurant_id=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 204 0 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:52:06 [info]: 	Decoded userId:
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Survey.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async listSurveys (file:///app/src/domains/surveys/surveys.controller.js:21:25)
2025-09-16 22:52:06 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:06 +0000] "GET /api/surveys?search=&restaurant_id=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
2025-09-16 22:52:07 [info]: 	Decoded userId:
2025-09-16 22:52:07 [info]: 	170.254.46.100 - - [16/Sep/2025:22:52:07 +0000] "GET /api/surveys?search=&restaurant_id=f88e9146-f139-4dac-9241-8367cc65f917 HTTP/1.1" 500 148 "https://feedelizapro.towersfy.com/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.select (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:407:12)
    at async Survey.findAll (/app/node_modules/sequelize/lib/model.js:1140:21)
    at async listSurveys (file:///app/src/domains/surveys/surveys.controller.js:21:25)