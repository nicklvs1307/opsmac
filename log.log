> Feedeliza+@1.0.0 start
> node backend/server.js
Swagger JSDoc options.apis: [ '/app/backend/routes/*.js' ]
Generated Swagger Specs (first 500 chars): {
  "openapi": "3.0.0",
  "info": {
    "title": "Check Test API",
    "version": "1.0.0",
    "description": "API documentation for the Check Test application."
  },
  "servers": [
    {
      "url": "https://feedelizaapi.towersfy.com/api",
      "description": "Production server"
    }
  ],
  "tags": [
    {
      "name": "Public API",
      "description": "Endpoints acessÃ­veis via API Token para integraÃ§Ã£o externa."
    },
    {
      "name": "Admin",
      "description": "Gerenciamento de us
âœ… ConexÃ£o com banco de dados estabelecida
âœ… Modelos sincronizados com o banco
ðŸš€ Servidor rodando na porta 5000
ðŸ“Š Dashboard: https://feedelizapro.towersfy.com
ðŸ”— API: https://feedelizaapi.towersfy.com/api
Auth Middleware - req.user (after population): {
  userId: '211aab5d-fb9a-421b-991c-fcda8bc44051',
  email: 'lucas@teste.com',
  role: 'owner',
  name: 'Lucas Niquele',
  restaurant_id: '0e517dc5-4881-45aa-996e-0365012000bc'
}
Wheel config items sent to spinWheel: [
  {
    id: '98cbbee9-613b-4ed0-a715-adb8092523dc',
    color: '#abcf8a',
    title: 'Suco de Laranja 1',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '22b9e4e0-484a-4e60-89ca-166126fa2d21',
    color: '#abcf8a',
    title: 'Suco de Laranja 2',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'cd3c2c87-0a38-4ca7-8339-6f6e6f990679',
    color: '#abcf8a',
    title: 'Suco de Laranja 3',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'eda6d361-98d2-404e-bb3a-e63a1afb4fa8',
    color: '#abcf8a',
    title: 'Suco de Laranja 4',
    textColor: '#121211',
    probability: 40
  },
  {
    id: '30b62fec-add7-467f-afaf-bb443946ac44',
    color: '#abcf8a',
    title: 'Suco de Laranja 5',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '1e4bbe2c-ef29-4ac8-b5b5-a4c6f7f96ab5',
    color: '#abcf8a',
    title: 'Suco de Laranja 6',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '287f2ce3-699f-4757-8f0b-45994850e287',
    color: '#abcf8a',
    title: 'Suco de abacate 7',
    textColor: '#121211',
    probability: 10
  }
]
Winning item from spinWheel: {
  id: 'eda6d361-98d2-404e-bb3a-e63a1afb4fa8',
  color: '#abcf8a',
  title: 'Suco de Laranja 4',
  textColor: '#121211',
  probability: 40
}
Winning index from spinWheel: 3
Erro ao girar a roleta: Error
    at Query.run (/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.insert (/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:308:21)
    at async model.save (/app/node_modules/sequelize/lib/model.js:2490:35)
    at async Coupon.create (/app/node_modules/sequelize/lib/model.js:1362:12)
    at async Reward.generateCoupon (/app/backend/models/Reward.js:331:20)
    at async /app/backend/routes/rewards.js:148:55 {
  name: 'SequelizeUniqueConstraintError',
  errors: [
    ValidationErrorItem {
      message: 'CÃ³digo do cupom jÃ¡ existe',
      type: 'unique violation',
      path: 'code',
      value: 'LUCAS9247',
      origin: 'DB',
      instance: [Coupon],
      validatorKey: 'not_unique',
      validatorName: null,
      validatorArgs: []
    }
  ],
  parent: error: duplicate key value violates unique constraint "coupons_code_key"
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 204,
    severity: 'ERROR',
    code: '23505',
    detail: 'Key (code)=(LUCAS9247) already exists.',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'coupons',
    column: undefined,
    dataType: undefined,
    constraint: 'coupons_code_key',
    file: 'nbtinsert.c',
    line: '663',
    routine: '_bt_check_unique',
    sql: 'INSERT INTO "coupons" ("id","code","title","description","value","reward_type","status","generated_at","expires_at","metadata","qr_code_data","notification_sent","reminder_sent","reward_id","customer_id","restaurant_id","created_at","updated_at") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING "id","code","title","description","value","reward_type","status","generated_at","expires_at","redeemed_at","cancelled_at","order_value","discount_applied","redemption_location","redemption_method","notes","metadata","qr_code_data","notification_sent","notification_sent_at","reminder_sent","reminder_sent_at","visit_milestone","reward_id","customer_id","restaurant_id","redeemed_by","created_at","updated_at";',
    parameters: [
      'e9153bdb-6d39-409d-a406-2f5713371c6b',
      'LUCAS9247',
      'Suco de abacate 7',
      'Suco de abacate 7',
      0,
      'free_item',
      'active',
      '2025-08-03 11:33:57.611 +00:00',
      null,
      '{"ip_address":null,"user_agent":null,"device_type":null,"location":null,"session_id":null,"staff_member":null}',
      '{"type":"coupon","code":"LUCAS9247","restaurant_id":"0e517dc5-4881-45aa-996e-0365012000bc","expires_at":null,"generated_at":"2025-08-03T11:33:57.611Z"}',

      false,

      false,
      '42a76eb4-d88a-4360-af2f-a0af2fe438b5',
      'c0463aa7-193d-42fc-9163-aa9c850a0546',
      '0e517dc5-4881-45aa-996e-0365012000bc',
      '2025-08-03 11:33:57.613 +00:00',
      '2025-08-03 11:33:57.613 +00:00'
    ]
  },
  original: error: duplicate key value violates unique constraint "coupons_code_key"
      at Parser.parseErrorMessage (/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TCP.onStreamRead (node:internal/stream_base_commons:191:23) {
    length: 204,
    severity: 'ERROR',
    code: '23505',
    detail: 'Key (code)=(LUCAS9247) already exists.',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'coupons',
    column: undefined,
    dataType: undefined,
    constraint: 'coupons_code_key',
    file: 'nbtinsert.c',
    line: '663',
    routine: '_bt_check_unique',
    sql: 'INSERT INTO "coupons" ("id","code","title","description","value","reward_type","status","generated_at","expires_at","metadata","qr_code_data","notification_sent","reminder_sent","reward_id","customer_id","restaurant_id","created_at","updated_at") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING "id","code","title","description","value","reward_type","status","generated_at","expires_at","redeemed_at","cancelled_at","order_value","discount_applied","redemption_location","redemption_method","notes","metadata","qr_code_data","notification_sent","notification_sent_at","reminder_sent","reminder_sent_at","visit_milestone","reward_id","customer_id","restaurant_id","redeemed_by","created_at","updated_at";',
    parameters: [
      'e9153bdb-6d39-409d-a406-2f5713371c6b',
      'LUCAS9247',
      'Suco de abacate 7',
      'Suco de abacate 7',
      0,
      'free_item',
      'active',
      '2025-08-03 11:33:57.611 +00:00',
      null,
      '{"ip_address":null,"user_agent":null,"device_type":null,"location":null,"session_id":null,"staff_member":null}',
      '{"type":"coupon","code":"LUCAS9247","restaurant_id":"0e517dc5-4881-45aa-996e-0365012000bc","expires_at":null,"generated_at":"2025-08-03T11:33:57.611Z"}',

      false,

      false,
      '42a76eb4-d88a-4360-af2f-a0af2fe438b5',
      'c0463aa7-193d-42fc-9163-aa9c850a0546',
      '0e517dc5-4881-45aa-996e-0365012000bc',
      '2025-08-03 11:33:57.613 +00:00',
      '2025-08-03 11:33:57.613 +00:00'
    ]
  },
  fields: { code: 'LUCAS9247' },
  sql: 'INSERT INTO "coupons" ("id","code","title","description","value","reward_type","status","generated_at","expires_at","metadata","qr_code_data","notification_sent","reminder_sent","reward_id","customer_id","restaurant_id","created_at","updated_at") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING "id","code","title","description","value","reward_type","status","generated_at","expires_at","redeemed_at","cancelled_at","order_value","discount_applied","redemption_location","redemption_method","notes","metadata","qr_code_data","notification_sent","notification_sent_at","reminder_sent","reminder_sent_at","visit_milestone","reward_id","customer_id","restaurant_id","redeemed_by","created_at","updated_at";'
}
Wheel config items sent to spinWheel: [
  {
    id: '98cbbee9-613b-4ed0-a715-adb8092523dc',
    color: '#abcf8a',
    title: 'Suco de Laranja 1',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '22b9e4e0-484a-4e60-89ca-166126fa2d21',
    color: '#abcf8a',
    title: 'Suco de Laranja 2',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'cd3c2c87-0a38-4ca7-8339-6f6e6f990679',
    color: '#abcf8a',
    title: 'Suco de Laranja 3',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'eda6d361-98d2-404e-bb3a-e63a1afb4fa8',
    color: '#abcf8a',
    title: 'Suco de Laranja 4',
    textColor: '#121211',
    probability: 40
  },
  {
    id: '30b62fec-add7-467f-afaf-bb443946ac44',
    color: '#abcf8a',
    title: 'Suco de Laranja 5',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '1e4bbe2c-ef29-4ac8-b5b5-a4c6f7f96ab5',
    color: '#abcf8a',
    title: 'Suco de Laranja 6',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '287f2ce3-699f-4757-8f0b-45994850e287',
    color: '#abcf8a',
    title: 'Suco de abacate 7',
    textColor: '#121211',
    probability: 10
  }
]
Winning item from spinWheel: {
  id: '287f2ce3-699f-4757-8f0b-45994850e287',
  color: '#abcf8a',
  title: 'Suco de abacate 7',
  textColor: '#121211',
  probability: 10
}
Winning index from spinWheel: 6
Wheel config items sent to spinWheel: [
  {
    id: '98cbbee9-613b-4ed0-a715-adb8092523dc',
    color: '#abcf8a',
    title: 'Suco de Laranja 1',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '22b9e4e0-484a-4e60-89ca-166126fa2d21',
    color: '#abcf8a',
    title: 'Suco de Laranja 2',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'cd3c2c87-0a38-4ca7-8339-6f6e6f990679',
    color: '#abcf8a',
    title: 'Suco de Laranja 3',
    textColor: '#121211',
    probability: 10
  },
  {
    id: 'eda6d361-98d2-404e-bb3a-e63a1afb4fa8',
    color: '#abcf8a',
    title: 'Suco de Laranja 4',
    textColor: '#121211',
    probability: 40
  },
  {
    id: '30b62fec-add7-467f-afaf-bb443946ac44',
    color: '#abcf8a',
    title: 'Suco de Laranja 5',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '1e4bbe2c-ef29-4ac8-b5b5-a4c6f7f96ab5',
    color: '#abcf8a',
    title: 'Suco de Laranja 6',
    textColor: '#121211',
    probability: 10
  },
  {
    id: '287f2ce3-699f-4757-8f0b-45994850e287',
    color: '#abcf8a',
    title: 'Suco de abacate 7',
    textColor: '#121211',
    probability: 10
  }
]
Winning item from spinWheel: {
  id: '287f2ce3-699f-4757-8f0b-45994850e287',
  color: '#abcf8a',
  title: 'Suco de abacate 7',
  textColor: '#121211',
  probability: 10
}
Winning index from spinWheel: 6