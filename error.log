> feedeliza-plus@1.0.0 start
> node backend/server.js
Redis Client Connected
‚úÖ Conex√£o com banco de dados estabelecida
üöÄ Servidor rodando na porta 5000
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: /iam/tree - userId: b4f05165-0144-4a9a-ab20-c8a417739f55 restaurantId: a42013f2-2970-4a72-b94c-6c8ed3e09fc9
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: checkRestaurantOwnership - req.params: { restaurantId: 'a42013f2-2970-4a72-b94c-6c8ed3e09fc9' }
DEBUG: checkRestaurantOwnership - req.query: {}
DEBUG: checkRestaurantOwnership - req.body: {}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: checkRestaurantOwnership - req.params: { restaurantId: 'a42013f2-2970-4a72-b94c-6c8ed3e09fc9' }
DEBUG: checkRestaurantOwnership - req.query: {}
DEBUG: checkRestaurantOwnership - req.body: {}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: checkRestaurantOwnership - req.params: { restaurantId: 'a42013f2-2970-4a72-b94c-6c8ed3e09fc9' }
DEBUG: checkRestaurantOwnership - req.query: {}
DEBUG: checkRestaurantOwnership - req.body: {}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}
DEBUG: authMiddleware - req.user after assignment: {
  "id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
  "name": "Lucas Niquele",
  "email": "lucas@teste.com",
  "phone": "3598989898",

  "roles": [
    {
      "id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
      "restaurantId": null,
      "key": "owner",
      "name": "owner",
      "isSystem": true,
      "createdAt": "2025-09-08T00:12:53.800Z",
      "updatedAt": "2025-09-08T00:12:53.800Z",
      "restaurant_id": null,
      "UserRole": {
        "userId": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurantId": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
        "roleId": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "createdAt": "2025-09-08T00:14:43.117Z",
        "updatedAt": "2025-09-08T00:14:43.117Z",
        "role_id": "26f17709-d148-46df-8d76-ec234bbc5f6d",
        "user_id": "b4f05165-0144-4a9a-ab20-c8a417739f55",
        "restaurant_id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9"
      }
    }
  ],
  "isActive": true,
  "restaurants": [
    {
      "id": "a42013f2-2970-4a72-b94c-6c8ed3e09fc9",
      "name": "Towersfy",
      "slug": "towersfy",
      "description": "123456",
      "address": "Rua Avenida Brasil",
      "city": "Andradas",
      "state": "MG",
      "zipCode": null,
      "phone": null,
      "email": null,
      "website": null,
      "logo": null,
      "planKey": null,
      "status": "active",
      "permVersion": "1",
      "createdAt": "2025-09-08T00:14:43.104Z",
      "updatedAt": "2025-09-08T00:14:43.104Z"
    }
  ],
  "restaurant": null,
  "restaurantId": null,
  "permissionSnapshot": null
}
DEBUG: checkRestaurantOwnership - req.params: { restaurantId: 'a42013f2-2970-4a72-b94c-6c8ed3e09fc9' }
DEBUG: checkRestaurantOwnership - req.query: {}
DEBUG: checkRestaurantOwnership - req.body: {}
Error caught by middleware: ForbiddenError: Acesso negado. Usu√°rio n√£o est√° associado a um restaurante.
    at checkRestaurantOwnership (/app/backend/src/middleware/checkRestaurantOwnershipMiddleware.js:24:19)
    at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/app/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/app/backend/src/middleware/authMiddleware.js:38:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  statusCode: 403
}